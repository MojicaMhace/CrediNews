<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Registration Test - CrediNews</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body class="auth-body">
    <div class="auth-container">
        <div class="auth-card">
            <div class="auth-header">
                <h2>Simple Registration Test</h2>
                <p>Testing registration without complex validation</p>
            </div>

            <form id="simpleRegisterForm">
                <div class="form-group">
                    <label for="fullName">Full Name</label>
                    <input type="text" id="fullName" name="fullName" value="Test User" required>
                </div>

                <div class="form-group">
                    <label for="email">Email Address</label>
                    <input type="email" id="email" name="email" value="test@example.com" required>
                </div>

                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" name="password" value="password123" required>
                </div>

                <button type="submit" class="auth-btn primary">
                    Register Now
                </button>
            </form>

            <div id="message" style="margin-top: 20px; padding: 10px; border-radius: 5px; display: none;"></div>
        </div>
    </div>

    <!-- Firebase SDK v8 -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    
    <script src="firebase-config.js"></script>

    <script>
        console.log('üöÄ Simple registration page loaded');

        function showMessage(text, type = 'info') {
            const messageDiv = document.getElementById('message');
            messageDiv.textContent = text;
            messageDiv.style.display = 'block';
            messageDiv.style.background = type === 'success' ? '#d4edda' : '#f8d7da';
            messageDiv.style.color = type === 'success' ? '#155724' : '#721c24';
            messageDiv.style.border = type === 'success' ? '1px solid #c3e6cb' : '1px solid #f5c6cb';
        }

        document.getElementById('simpleRegisterForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            console.log('üî• Form submitted!');

            const fullName = document.getElementById('fullName').value;
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            console.log('üìù Form data:', { fullName, email, password: '***' });

            try {
                console.log('üî• Starting Firebase registration...');
                
                // Create user
                const userCredential = await firebase.auth().createUserWithEmailAndPassword(email, password);
                const user = userCredential.user;
                
                console.log('‚úÖ User created:', user.uid);
                
                // Wait for auth state to be established
                await new Promise(resolve => {
                    const unsubscribe = firebase.auth().onAuthStateChanged(authUser => {
                        if (authUser && authUser.uid === user.uid) {
                            unsubscribe();
                            resolve();
                        }
                    });
                });
                
                console.log('‚úÖ Auth state confirmed');
                
                // Now try to store user profile (user should be authenticated)
                try {
                    await firebase.firestore().collection('users').doc(user.uid).set({
                        fullName: fullName,
                        email: email,
                        createdAt: new Date().toISOString(),
                        role: 'user'
                    });
                    console.log('‚úÖ User profile stored in Firestore');
                } catch (firestoreError) {
                    console.warn('‚ö†Ô∏è Could not store user profile in Firestore:', firestoreError.message);
                    console.log('üìù This might be due to Firestore security rules, but registration still succeeded');
                }
                
                // Store auth data locally
                const authData = {
                    uid: user.uid,
                    email: user.email,
                    fullName: fullName,
                    isAuthenticated: true,
                    registrationTime: new Date().toISOString()
                };
                
                sessionStorage.setItem('authData', JSON.stringify(authData));
                console.log('‚úÖ Auth data stored locally');
                
                showMessage('‚úÖ Registration successful! Redirecting...', 'success');
                
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 2000);
                
            } catch (error) {
                console.error('‚ùå Registration error:', error);
                
                let errorMessage = 'Registration failed: ' + error.message;
                if (error.code === 'auth/email-already-in-use') {
                    errorMessage = 'Email already in use. Try a different email.';
                }
                
                showMessage(errorMessage, 'error');
            }
        });

        // Auto-generate unique email for testing
        document.getElementById('email').value = 'test' + Date.now() + '@example.com';
    </script>
</body>
</html>